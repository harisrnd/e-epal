
import {Component} from '@angular/core';
import { Router } from '@angular/router';

import {Router, ActivatedRoute, Params} from '@angular/router';
import {OnInit, Component} from '@angular/core';
import { LoginInfoActions } from '../actions/logininfo.actions';

import {
    FormBuilder,
    FormsModule, 
    FormGroup,
    FormControl,
    FormArray
} from '@angular/forms';

import {GlobalEventsManager} from "../services/login-service";

=======
import { AppSettings } from '../app.settings';

@Component({
  selector: 'home',
  template: `
  <div>
    <h4>Στοιχεία Σύνδεσης</h4>

  <form [formGroup]="formGroup">
           <div class="form-group">
           <div *ngIf = "loginerror " class = "alert alert-danger">Λάθος στοιχεία εισόδου</div>
              <label for="UserName">Όνομα Χρήστη</label>
              <input class="form-control" type="text" formControlName="UserName" cols="10" required>
            </div> 
            <div *ngIf = "usernamevalidation " class = "alert alert-danger">Απαιτείται το όνομα χρήστη</div>
             <div class="form-group">
              <label for="Paswd">Κωδικός Ασφαλείας</label>
              <input class="form-control" type="password" formControlName="Paswd" cols="10" required>
           
            </div>  
            <div *ngIf = "passvalidation " class = "alert alert-danger">Απαιτείται ο κωδικός πρόσβασης</div>
            <div class="row">
              <div class="col-md-2 col-md-offset-5">
                <button type="button" class="btn-primary btn-lg pull-center" (click)="onLoginSuccessfully()">
                Συνέχεια
                </button>
            </div>
        </div>
   
  <form [formGroup]="formGroup" method = "POST" action="http://eepal.dev/drupal/oauth/login" #form>
            <input type="hidden" name="X-oauth-enabled" value="true">
            <div class="row">
              <div class="col-md-2 col-md-offset-5">
                <button type="submit" class="btn-primary btn-lg pull-center" (click)="form.submit()">
                Είσοδος μέσω TaxisNet<span class="glyphicon glyphicon-menu-right"></span>
                </button>
            </div>
        </div>
     </form>
  </div>
  `
})

export default class Home { 
  public logined = false;  
	public formGroup: FormGroup;
  usernamevalidation = false;
  passvalidation = false;
  loginerror = false;

       constructor(private fb: FormBuilder,
                   private router: Router,
                   private globalEventsManager: GlobalEventsManager) {
=======
export default class Home implements OnInit{
	public formGroup: FormGroup;
       constructor(private fb: FormBuilder,
           private _ata: LoginInfoActions,
           private activatedRoute: ActivatedRoute) {
>>>>>>> 830874b9f9533be54e9e43e3c3229884b3eeb119
       this.formGroup = this.fb.group({
            UserName: [],
            Paswd : []
            });
        };

    ngOnInit() {
    // subscribe to router event
        this.activatedRoute.queryParams.subscribe((params: Params) => {
        let authToken = params['auth_token'];
        let authRole = params['auth_role'];
        this._ata.saveLoginInfo({auth_token: authToken, auth_role: authRole});
        console.log(authToken);

      });
  }




  private onLoginSuccessfully(data : any) : void {
    if (this.formGroup.value.UserName == null)
           { 
             this.usernamevalidation = true;
           }
           else  
           {
             this.usernamevalidation = false;     
           }
    if (this.formGroup.value.Paswd == null)
            { 
              this.passvalidation = true;
            }
            else
            {
              this.passvalidation = false;  
            }
    if  ((this.formGroup.value.UserName == "admin") && (this.formGroup.value.Paswd == "admin")) 
    {
          this.globalEventsManager.showNavBar(true);
          this.router.navigate(['/amka-fill']);
 }
    else
    {
        this.loginerror = true;
    }


        }
    }
